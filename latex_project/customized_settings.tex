%****************************************************************%
% FILE: customized_settings.tex                                  %
% used packeges                                                  %
% customized settings                                            %
% font, footnotes, utilities, hyperlinks, graphics,              %
% custom colors, code style, bibliography(with Ivi, cit, ibidem) % 
%****************************************************************%

%****************************************************************%
%                             font                               %
%****************************************************************%
% use helvetica font
\usepackage[scaled]{helvet}
\usepackage[T1]{fontenc}
\renewcommand\familydefault{\sfdefault}

%****************************************************************%
%                          footnotes                             %
%****************************************************************%
% footnotes at the end of page with no indentation!
\usepackage[bottom,hang,flushmargin]{footmisc}
\interfootnotelinepenalty=10000

%****************************************************************%
%                         utilities                              %
%****************************************************************%
%\usepackage{tikz}
%\usetikzlibrary{external}
%\tikzexternalize[prefix=tikz/]
% to use most of the maths symbols
\usepackage{fdsymbol}

\usepackage{parskip}
\usepackage{geometry}
\usepackage{changepage}
% SI symbols
\usepackage{siunitx} 
% subfiles
\usepackage{subfiles}
% empty pages (removes headers and footers from empty pages!)
\usepackage{emptypage}
% fancy headers and footers
\usepackage{fancyhdr}
\fancyhf{}
\fancyhead[LE]{\nouppercase{\rightmark\hfill\leftmark}}
\fancyhead[RO]{\nouppercase{\leftmark\hfill\rightmark}}
\fancyfoot[LE,RO]{\hfill\thepage\hfill}
% compability for fancy (if removes gives warning!)
\setlength{\headheight}{14.49998pt}

%****************************************************************%
%                         hyperlink                              %
%****************************************************************%
\usepackage{hyperref}
\usepackage{xurl} 

%****************************************************************%
%                         graphics                               %
%****************************************************************%
% colors
\usepackage{xcolor}
% required for inserting images
\usepackage{graphicx} 
% required for svg files
%\usepackage{svg} 
% image caption
\usepackage{caption} 

%****************************************************************%
%                      customized colors                         %
%****************************************************************%
\definecolor{c_mandarino}{rgb}{0.86,0.43,0.07}
\definecolor{c_blood}{rgb}{0.74,0.25,0.16}
\definecolor{c_senape}{rgb}{0.84,0.56,0.13}
\definecolor{c_olivine}{rgb}{0.51,0.50,0.23}
\definecolor{c_salmon}{rgb}{0.78,0.42,0.32}
\definecolor{c_background}{rgb}{0.98,0.98,0.93}
\definecolor{c_milkchoco}{rgb}{0.69,0.42,0.22}
\definecolor{c_mattone_nfs}{rgb}{0.54,0.31,0.29}
\definecolor{c_not_so_black}{rgb}{0.36, 0.33, 0.25}

%****************************************************************%
%                      box definitions                           %
%****************************************************************%
% citation
\usepackage{csquotes}
% code
\usepackage{listings} 
% definition box
\usepackage{tcolorbox} 
\tcbuselibrary{theorems}
% not a block but the epigaph on chapters
\usepackage{epigraph} 
\setlength{\epigraphrule}{0pt} % no rule
\renewcommand*{\textflush}{flushright} % align on right page
\renewcommand*{\epigraphsize}{\normalsize\itshape} % font size and style

% to justify epigraph
\usepackage{ragged2e} 
%****************************************************************%
%                      code listing style                        %
%****************************************************************%
\lstdefinestyle{mycodestyle}{
  basicstyle=\ttfamily\footnotesize,
  backgroundcolor=\color{c_background},
  commentstyle=\color{c_olivine},
  keywordstyle=\color{c_blood},
  numberstyle=\tiny\color{c_milkchoco},
  stringstyle=\color{c_mattone_nfs},
  identifierstyle=\color{c_not_so_black},
  \lst@ifdisplaystyle\scriptsize\fi,
  breakatwhitespace=false,         
  breaklines=true,                 
  captionpos=b,                    
  keepspaces=true,                 
  numbers=left,                    
  numbersep=5pt,                  
  showspaces=false,                
  showstringspaces=false,
  showtabs=false,                  
  tabsize=2,
}

% "mycodestyle" code listing set
\lstset{style=mycodestyle}

% edit lstlisting caption %
\captionsetup[lstlisting]{font={footnotesize}}

% customized style for json 
\lstdefinelanguage{json}{
    basicstyle=\ttfamily\footnotesize,
    numberstyle=\tiny\color{c_milkchoco},
    commentstyle=\color{c_olivine},
    stringstyle=\color{c_mattone_nfs},
    identifierstyle=\color{c_not_so_black},
    numbers=left,
    captionpos=b,                    
    numbersep=5pt, 
    stepnumber=1,
    tabsize=2,
    numbersep=8pt,
    showstringspaces=false,
    showtabs=false, 
    showspaces=false,    
    keepspaces=true,                 
    breaklines=true,
    backgroundcolor=\color{c_background},
    string=[s]{"}{"},
    comment=[l]{:\ "},
    morecomment=[l]{:"},
    literate=
        *{0}{{{\color{c_senape}0}}}{1}
         {1}{{{\color{c_senape}1}}}{1}
         {2}{{{\color{c_senape}2}}}{1}
         {3}{{{\color{c_senape}3}}}{1}
         {4}{{{\color{c_senape}4}}}{1}
         {5}{{{\color{c_senape}5}}}{1}
         {6}{{{\color{c_senape}6}}}{1}
         {7}{{{\color{c_senape}7}}}{1}
         {8}{{{\color{c_senape}8}}}{1}
         {9}{{{\color{c_senape}9}}}{1}
}

% customized style for javascript
\lstdefinelanguage{JavaScript}{
  basicstyle=\ttfamily\footnotesize,
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
  keywordstyle=\color{c_blood},
  ndkeywords={class, export, boolean, throw, implements, import, this},
  backgroundcolor=\color{c_background}, 
  numberstyle=\tiny\color{c_milkchoco},
  ndkeywordstyle=\color{c_blood},
  identifierstyle=\color{c_not_so_black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{c_olivine},
  stringstyle=\color{c_mattone_nfs},
  morestring=[b]',
  morestring=[b]",
  breakatwhitespace=false,         
  breaklines=true,                 
  captionpos=b,                    
  keepspaces=true,                 
  numbers=left,                    
  numbersep=5pt,                  
  showspaces=false,                
  showstringspaces=false,
  showtabs=false,                  
  tabsize=2
}

%****************************************************************%
%                      subsubsection numbers                     %
%****************************************************************%
\setcounter{secnumdepth}{3} % document
\setcounter{tocdepth}{3} % content

%****************************************************************%
%                   lenght of indent of /par                     %
%****************************************************************%
\setlength{\parindent}{20pt}

%****************************************************************%
%                         bibliography                           %
%****************************************************************%
\usepackage{xpatch}  
\usepackage[style=verbose-trad1,  
            bibstyle=authortitle,
            minbibnames=4,
            maxbibnames=4,  % to show max 4 authors in print biblio, then et al
            backref=true
            language=italian,
            useprefix=true,                 
            giveninits=true,    
            citepages=omit,
            backend=biber,  
            hyperref=false,
            ibidpage=true,
        ]{biblatex} 
\addbibresource{bibliography.bib}

% Ivi: rispetto alla nota precedente cambia solo il numero di pagina
% Ibidem/ibid: riferiemnto a un testo citato nella nota precedente (stessa pagina)
% cit. opera già citata MA non nella nota precedente
% ID: stesso autore

% il codice sotto serve per mettere Ivi, Ibid, Id e cit
% GRAZIE A https://tex.stackexchange.com/questions/418701/how-to-custom-split-in-two-ibidem <3
\NewBibliographyString{ibidemloccit,ibidemnoloccit,opcit}
\DefineBibliographyStrings{italian}{%
  idem           = {\textit{\textsc{id}}},
  ibidemloccit   = {\mkbibemph{\textit{\autocap{i}bid\adddot}}},
  ibidemnoloccit = {\autocap{i}vi},
  opcit          = {\autocap{c}it\adddot},
  loccit         = {\autocap{c}it\adddot},
}

\xpatchbibmacro{author}
  {\printnames{author}}
  {\iffootnote
     {\ifthenelse{\ifciteidem\AND\NOT\boolean{cbx:noidem}}
       {\usebibmacro{cite:idem}}
       {\printnames{author}}}
     {\printnames{author}}}
  {}{}
  
\xpatchbibmacro{bbx:editor}
{\printnames{editor}}
  {\iffootnote
     {\ifthenelse{\ifciteidem\AND\NOT\boolean{cbx:noidem}}
        {\usebibmacro{cite:idem}}
        {\printnames{editor}}}
     {\printnames{editor}}}
  {}{}
  
\xpatchbibmacro{bbx:translator}
  {\printnames{translator}}
  {\iffootnote
    {\ifthenelse{\ifciteidem\AND\NOT\boolean{cbx:noidem}}
        {\usebibmacro{cite:idem}}
        {\printnames{translator}}}
     {\printnames{translator}}}
  {}{}
  

\renewbibmacro*{cite:ibid}{%
  \printtext{%
    \bibhyperlink{cite\csuse{cbx@lastcite@\thefield{entrykey}}}{%
       \ifloccit
        {\bibstring[\mkibid]{ibidemloccit}%
         \global\toggletrue{cbx:loccit}}
        {\bibstring[\mkibid]{ibidemnoloccit}}%
       }
       {}}}
       
% esclude i campi ad ogni citazione (non nella bilbio)
% lo faccio perché sto usando lo stile verbose-trad1
\AtEveryCitekey{%
    \clearfield{note}%
    \clearfield{year}%
    \clearfield{month}%
    \clearfield{url}%
    \clearfield{doi}%
    \clearfield{booktitle}%
    \clearfield{isbn}%
    \clearfield{issn}%
    \clearlist{editor}%
    \clearfield{version}%
    \clearfield{series}%
    \clearfield{volume}%
    \clearfield{number}%
    \clearfield{edition}%
    \clearlist{organization}%
}

% remove in when there is no journal
\renewbibmacro*{in:}{%
  \iffieldundef{journaltitle}
    {}
    {\printtext{\bibstring{in}\intitlepunct}}}
    
% remove () when there is no year to show
\renewbibmacro*{issue+date}{%
  \ifboolexpr{test {\iffieldundef{year}}
              and test {\iffieldundef{issue}}}
    {}
    {\printtext[parens]{%
       \printfield{issue}%
       \setunit*{\addspace}%
       \usebibmacro{date}}}%
  \newunit}

% IMPORTANT
% workaround for references not respecting margins with biblatex
% thx to https://tex.stackexchange.com/questions/287748/references-not-respecting-margins-with-biblatex
\appto{\bibsetup}{\sloppy}